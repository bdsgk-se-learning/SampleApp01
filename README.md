# SampleApp01

Polaris の SAST/SCA/DAST の解析対象のサンプルです。
Python/Flask で作成された、ユーザー認証と管理機能を備えたWebアプリケーションです。
主な機能には、二段階認証（2FA）、パスワード管理、管理者機能が含まれています。
パッケージ管理にpipenvを使用しています。

演習１，２，３で使用します。

## 主な機能

- ユーザー認証（ユーザー名/パスワード）
- 二段階認証（TOTP/Google Authenticator互換）
- アカウント管理（パスワード変更、2FA設定）
- 管理者機能（ユーザー管理、パスワードリセット）

## DAST 解析対象の構築

演習でDAST解析のターゲットが必要なときは、このアプリケーションを起動して使用してください。以下の事前準備が必要です。

### 必要なもの

* Python3
* pipenv

### インストール方法

依存関係のインストール

```bash
cd SampleApp01
pipenv shell
pipenv install
```

データベースの初期設定とアップグレード
```bash
python manage_db.py
```
このコマンドを実行すると、以下の処理が行われます：
- データベース（app.db）の作成（存在しない場合）
- スキーマの最新バージョンへのアップグレード
- 管理者ユーザー（admin）の作成（存在しない場合）

注: データベースを初期化するには、既存のapp.dbを削除してから上記コマンドを実行してください。

### 起動方法

```bash
python server.py
```

http://localhost:5000 でアクセスして、ログインページが表示されたら起動完了です。

初期セットアップ時に作成される管理者アカウント：
- ユーザー名: admin
- パスワード: admin

新規ユーザーは「ユーザー登録」から作成できます。登録時に二段階認証の有効/無効を選択できます。
すべてのユーザー情報は、app.db（SQLite）に保存されます。

停止時は、CTRL+C で停止してください。

## セキュリティ機能

- パスワードハッシュ化（Werkzeug）
- TOTP二段階認証（Google Authenticator互換）
- CSRF保護
- セッション管理とタイムアウト
- 管理者権限の制御

### API

http://localhost:5000/apidocs/ から SwaggerのAPIドキュメントを表示することができます。
